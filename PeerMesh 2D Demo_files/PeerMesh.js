var _0x3f27 = [];
//_0x3f27[0] = "upload";
//_0x3f27[1] = "totalDownload";
//_0x3f27[2] = "imageServerDownload"
//_0x3f27[3] = "imageServerPercent"
//_0x3f27[4] = "peerDownload"
//_0x3f27[5] = "peerPercent"
//_0x3f27[6] = "listener"
//_0x3f27[7] = "isDebug"
//_0x3f27[8] = "isShowLog"
//_0x3f27[9] = "consoleTextArea";
//_0x3f27[10] = "addUploadSize"
//_0x3f27[11] = "addDownloadSize";
//_0x3f27[12] = "log";
//_0x3f27[13] = "value";
//_0x3f27[14] = "\n";
//_0x3f27[15] = "mozGetUserMedia";
//_0x3f27[16] = "This appears to be Firefox";
//_0x3f27[17] = "firefox"
//_0x3f27[18] = "bind"
//_0x3f27[19] = "Attaching media stream"
//_0x3f27[20] = "mozSrcObject"
//_0x3f27[21] = "play"
//_0x3f27[22] = "Reattaching media stream"
//_0x3f27[23] = "getVideoTracks"
//_0x3f27[24] = "prototype"
//_0x3f27[25] = "getAudioTracks"
//_0x3f27[26] = "webkitGetUserMedia"
//_0x3f27[27] = "This appears to be Chrome"
//_0x3f27[28] = "chrome"
//_0x3f27[29] = "srcObject"
//_0x3f27[30] = "undefined"
//_0x3f27[31] = "src"
//_0x3f27[32] = "createObjectURL"
//_0x3f27[33] = "Error attaching stream to element."
//_0x3f27[34] = "videoTracks"
//_0x3f27[35] = "audioTracks"
//_0x3f27[36] = "getLocalStreams"
//_0x3f27[37] = "localStreams"
//_0x3f27[38] = "getRemoteStreams"
//_0x3f27[39] = "remoteStreams"
//_0x3f27[40] = "Browser does not appear to be WebRTC-capable"
//_0x3f27[41] = "getLength"
//_0x3f27[42] = "length"
//_0x3f27[43] = "isEmpty"
//_0x3f27[44] = "enqueue"
//_0x3f27[45] = "push"
//_0x3f27[46] = "dequeue"
//_0x3f27[47] = "slice"
//_0x3f27[48] = "peek"
//_0x3f27[49] = "SESSION_ID"
//_0x3f27[50] = "session_id"
//_0x3f27[51] = "FILE_NOT_FOUND"
//_0x3f27[52] = "file_not_found"
//_0x3f27[53] = "FILE_FOUND"
//_0x3f27[54] = "file_found"
//_0x3f27[55] = "OFFER_IMAGE_REQUEST"
//_0x3f27[56] = "offer_image_request"
_0x3f27[57] = "OFFER_CANDIDATE"
_0x3f27[58] = "offer_candidate"
_0x3f27[59] = "OFFER_SDP"
_0x3f27[60] = "offer_sdp"
_0x3f27[61] = "ANSWER_CANDIDATE"
_0x3f27[62] = "answer_candidate"
_0x3f27[63] = "ANSWER_SDP"
_0x3f27[64] = "answer_sdp"
//_0x3f27[65] = "HAS_IMAGE"
//_0x3f27[66] = "has_image"
//_0x3f27[67] = "REQUEST_IMAGE"
//_0x3f27[68] = "request_image"
//_0x3f27[69] = "APPLICATION"
//_0x3f27[70] = "appName"
//_0x3f27[71] = "REQUEST_CON_COUNT"
//_0x3f27[72] = "reqConCount"
//_0x3f27[73] = "COUNT"
//_0x3f27[74] = "count"
//_0x3f27[75] = "requestImageObject"
//_0x3f27[76] = "hasImageObject"
//_0x3f27[77] = "getSize"
//_0x3f27[78] = "getHash"
//_0x3f27[79] = "getUrl"
//_0x3f27[80] = "requestFileObject"
//_0x3f27[81] = "ACTION_REQUEST_FILE"
//_0x3f27[82] = "url"
//_0x3f27[83] = "callback"
//_0x3f27[84] = "hash"
//_0x3f27[85] = "calculateHash";
//_0x3f27[86] = "size"
//_0x3f27[87] = "loadMethod"
//_0x3f27[88] = "convertBase64Method"
//_0x3f27[89] = "convertResponseTypeMethod"
//_0x3f27[90] = "defineUrlType"
//_0x3f27[91] = "BLOB_TYPE"
//_0x3f27[92] = "loadImage"
//_0x3f27[93] = "convertByteToBase64"
//_0x3f27[94] = "convertByteToBlob"
//_0x3f27[95] = "TEXT_TYPE"
//_0x3f27[96] = "byteToString"
//_0x3f27[97] = "JSON_TYPE"
//_0x3f27[98] = "parse"
//_0x3f27[99] = "ARRAY_BUFFER_TYPE"
//_0x3f27[100] = "buffer"
//_0x3f27[101] = "IMAGE_TYPE"
//_0x3f27[102] = "."
//_0x3f27[103] = "lastIndexOf"
//_0x3f27[104] = "toLowerCase"
//_0x3f27[105] = "substr"
//_0x3f27[106] = "jpg"
//_0x3f27[107] = "png"
//_0x3f27[108] = "gif"
//_0x3f27[109] = "jpeg"
//_0x3f27[110] = "load"
//_0x3f27[111] = "convertBase64"
//_0x3f27[112] = "isResponseTypeBase64"
//_0x3f27[113] = "convertResponseType"
//_0x3f27[114] = "sendCallback"
//_0x3f27[115] = "setHash"
//_0x3f27[116] = "setSize"
//_0x3f27[117] = "charCodeAt"
_0x3f27[118] = "LONG_BYTE_LENGTH"
//_0x3f27[119] = "longToByteArray"
//_0x3f27[120] = "byteArrayToLong"
//_0x3f27[121] = "calculateLoopSize"
//_0x3f27[122] = "byteLength"
_0x3f27[123] = ""
//_0x3f27[124] = "min"
//_0x3f27[125] = "apply"
//_0x3f27[126] = "fromCharCode"
//_0x3f27[127] = "bytesToSize";
_0x3f27[128] = " B"
//_0x3f27[129] = "toFixed"
_0x3f27[130] = " KB";
_0x3f27[131] = " MB"
_0x3f27[132] = " GB"
_0x3f27[133] = " TB"
//_0x3f27[134] = "ByteArray"
_0x3f27[135] = "buf"
_0x3f27[136] = "bufView"
//_0x3f27[137] = "index"
//_0x3f27[138] = "addArray"
//_0x3f27[139] = "getArray"
//_0x3f27[140] = "getArrayBuffer"
//_0x3f27[141] = "getLong"
//_0x3f27[142] = "FileByteArray"
_0x3f27[143] = "loopSize"
_0x3f27[144] = "SLICE"
_0x3f27[145] = "cache"
//_0x3f27[146] = "contains"
//_0x3f27[147] = "get"
//_0x3f27[148] = "getData"
//_0x3f27[149] = "getBinaryData"
//_0x3f27[150] = "convertBase64ToByte"
//_0x3f27[151] = "putData"
//_0x3f27[152] = "==========="
_0x3f27[153] = " length:"
//_0x3f27[154] = "put"
_0x3f27[155] = "browserSupport"
_0x3f27[156] = "isBrowserSupport"
_0x3f27[157] = "applicationName"
//_0x3f27[158] = "peerServerUrl"
//_0x3f27[159] = "PEER_WEBSOCKET_URL"
//_0x3f27[160] = "dataManager"
//_0x3f27[161] = "requestCallback"
//_0x3f27[162] = "socket"
//_0x3f27[163] = "SIGNALING_URL"
//_0x3f27[164] = "ws"
//_0x3f27[165] = "replace"
//_0x3f27[166] = "origin"
//_0x3f27[167] = "/PeerMeshServer"
_0x3f27[168] = "/signaling"
_0x3f27[169] = "blob"
_0x3f27[170] = "text"
_0x3f27[171] = "image"
_0x3f27[172] = "arraybuffer"
//_0x3f27[173] = "json"
//_0x3f27[174] = "request"
//_0x3f27[175] = "File is in Local Storage!"
//_0x3f27[176] = "Browser Does not support webrtc!"
//_0x3f27[177] = "requestPeerServer"
//_0x3f27[178] = "loadFile"
//_0x3f27[179] = "initialize"
//_0x3f27[180] = "getConnectionCount"
//_0x3f27[181] = "send"
//_0x3f27[182] = "connectionCountListener"
//_0x3f27[183] = "getTime"
//_0x3f27[184] = "File is load from real server! "
//_0x3f27[185] = "ms"
//_0x3f27[186] = "fileFound"
//_0x3f27[187] = "file is load from another client"
//_0x3f27[188] = "fileNotFound"
//_0x3f27[189] = "file not found"
//_0x3f27[190] = "file is load from server"
//_0x3f27[191] = "Browser does not support websocket or webrtc"
//_0x3f27[192] = "peerConnectionMap"
//_0x3f27[193] = "id"
//_0x3f27[194] = "peerManager"
//_0x3f27[195] = "fileNotFoundCallback"
//_0x3f27[196] = "fileFoundCallback"
//_0x3f27[197] = "isOpened"
//_0x3f27[198] = "isInit"
//_0x3f27[199] = "callbackList"
//_0x3f27[200] = "onopen";
//_0x3f27[201] = "onclose";
//_0x3f27[202] = "onerror";
//_0x3f27[203] = "onmessage";
//_0x3f27[204] = "getTotalQueueSize";
//_0x3f27[205] = "getQueueSize";
//_0x3f27[206] = "Total Queue Size:";
_0x3f27[207] = "_";
//_0x3f27[208] = "fireCallbacks";
//_0x3f27[209] = "getFileList";
//_0x3f27[210] = "data";
//_0x3f27[211] = "file";
//_0x3f27[212] = "Action:";
//_0x3f27[213] = "action";
//_0x3f27[214] = " File:";
//_0x3f27[215] = "Session Id:"
//_0x3f27[216] = "requestFile"
//_0x3f27[217] = "setFileEventCallback"
//_0x3f27[218] = "createOffer"
//_0x3f27[219] = "createAnswer"
//_0x3f27[220] = "setOfferSdp"
//_0x3f27[221] = "addCandidate"
//_0x3f27[222] = "setRemoteDescription"
//_0x3f27[223] = "stringify"
//_0x3f27[224] = "sendAction"
//_0x3f27[225] = "isAnswerCreated"
//_0x3f27[226] = "fileFoundScope"
//_0x3f27[227] = "messageQueue"
//_0x3f27[228] = "isSendingMessage"
//_0x3f27[229] = "intervalId"
//_0x3f27[230] = "channel"
_0x3f27[231] = "t"
//_0x3f27[232] = "stun:stun.l.google.com:19302"
//_0x3f27[233] = "turn:numb.viagenie.ca"
_0x3f27[234] = "Breakfast1905!"
_0x3f27[235] = "emreesirik@gmail.com"
_0x3f27[236] = "mozRTCPeerConnection"
//_0x3f27[237] = "pc"
//_0x3f27[238] = "candidates"
//_0x3f27[239] = "STRING_MESSAGE"
_0x3f27[240] = "js:"
_0x3f27[241] = "request_file"
//_0x3f27[242] = "sendJson"
//_0x3f27[243] = "offerSdp"
//_0x3f27[244] = "addIceCandidate"
//_0x3f27[245] = "setLocalDescription"
//_0x3f27[246] = "onicecandidate"
//_0x3f27[247] = "candidate"
_0x3f27[248] = "Offer with ICE candidates: "
//_0x3f27[249] = "ondatachannel"
_0x3f27[250] = "channel on data"
//_0x3f27[251] = "binaryType"
_0x3f27[252] = "channel opened"
_0x3f27[253] = " ms."
//_0x3f27[254] = "onMessage"
_0x3f27[255] = "---onicecandidate_"
//_0x3f27[256] = "sendChannel"
//_0x3f27[257] = "createDataChannel"
//_0x3f27[258] = "sendFile"
_0x3f27[259] = "---channel_open"
_0x3f27[260] = "---channel_onmessage"
_0x3f27[261] = "oniceconnectionstatechange"
_0x3f27[262] = "---createoffer_"
_0x3f27[263] = "---errorrr_"
//_0x3f27[264] = "splitDataAndPutQueue"
//_0x3f27[265] = "enqueueMessage"
//_0x3f27[266] = "sendNextMessage"
//_0x3f27[267] = "channel action"
//_0x3f27[268] = "message"
//_0x3f27[269] = "fileList"
//_0x3f27[270] = "ITEMS_KEY"
//_0x3f27[271] = "PeerFiles"
//_0x3f27[272] = "FILE_PREFIX"
//_0x3f27[273] = "Peer:"
//_0x3f27[274] = "getItem"
//_0x3f27[275] = "putLocalStorage"
//_0x3f27[276] = "QUOTA_EXCEEDED_ERR"
//_0x3f27[277] = "code"
//_0x3f27[278] = "_keyStr"
//_0x3f27[279] = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="
//_0x3f27[280] = "GET"
//_0x3f27[281] = "open"
//_0x3f27[282] = "responseType"
//_0x3f27[283] = "onload"
//_0x3f27[284] = "response"
//_0x3f27[285] = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
//_0x3f27[286] = "==";
//_0x3f27[287] = "=";
//_0x3f27[288] = "data:image/jpeg;base64,"
//_0x3f27[289] = "base64,";
//_0x3f27[290] = "indexOf";
//_0x3f27[291] = "charAt";

PeerStatistic = function () {
};
PeerStatistic["upload"] = 0;
PeerStatistic["totalDownload"] = 0;
PeerStatistic["imageServerDownload"] = 0;
PeerStatistic["imageServerPercent"] = 0;
PeerStatistic["peerDownload"] = 0;
PeerStatistic["peerPercent"] = 0;
PeerStatistic["listener"] = null;
PeerStatistic["isDebug"] = false;
PeerStatistic.isShowLog = false;
PeerStatistic.consoleTextArea;
PeerStatistic.addUploadSize = function (sz) {
    PeerStatistic['upload'] += sz;
    if (PeerStatistic["listener"] != null) {
        PeerStatistic["listener"]();
    }
    ;
};
PeerStatistic.addDownloadSize = function (sz, isFromPeer) {
    PeerStatistic.totalDownload += sz;
    if (isFromPeer) {
        PeerStatistic.peerDownload += sz;
    } else {
        PeerStatistic.imageServerDownload += sz;
    }
    ;
    PeerStatistic["peerPercent"] = (PeerStatistic["peerDownload"] * 100) / PeerStatistic["totalDownload"];
    PeerStatistic["imageServerPercent"] = (PeerStatistic["imageServerDownload"] * 100) / PeerStatistic["totalDownload"];
    if (PeerStatistic["listener"] != null) {
        PeerStatistic["listener"]();
    }
    ;
};
PeerStatistic.log = function (msg) {
    if (PeerStatistic.isShowLog) {
        if (PeerStatistic.isDebug) {
            PeerStatistic.consoleTextArea.value += msg + "\n";
        } else {
            console.log(msg);
        }
        ;
    }
    ;
};
var RTCPeerConnection = null;
var getUserMedia = null;
var attachMediaStream = null;
var reattachMediaStream = null;
var webrtcDetectedBrowser = null;
if (navigator["mozGetUserMedia"]) {
    PeerStatistic.log("This appears to be Firefox");
    webrtcDetectedBrowser = "firefox";
    RTCPeerConnection = mozRTCPeerConnection;
    RTCSessionDescription = mozRTCSessionDescription;
    RTCIceCandidate = mozRTCIceCandidate;
    getUserMedia = navigator["mozGetUserMedia"]["bind"](navigator);
    attachMediaStream = function (_0xb539x9, _0xb539xa) {
        PeerStatistic.log("Attaching media stream");
        _0xb539x9["mozSrcObject"] = _0xb539xa;
        _0xb539x9["play"]();
    };
    reattachMediaStream = function (_0xb539xb, _0xb539xc) {
        PeerStatistic.log("Reattaching media stream");
        _0xb539xb["mozSrcObject"] = _0xb539xc["mozSrcObject"];
        _0xb539xb["play"]();
    };
    MediaStream["prototype"]["getVideoTracks"] = function () {
        return [];
    };
    MediaStream["prototype"]["getAudioTracks"] = function () {
        return [];
    };
} else {
    if (navigator["webkitGetUserMedia"]) {
        PeerStatistic.log("This appears to be Chrome");
        webrtcDetectedBrowser = "chrome";
        RTCPeerConnection = webkitRTCPeerConnection;
        getUserMedia = navigator["webkitGetUserMedia"]["bind"](navigator);
        attachMediaStream = function (_0xb539x9, _0xb539xa) {
            if (typeof _0xb539x9["srcObject"] !== "undefined") {
                _0xb539x9["srcObject"] = _0xb539xa;
            } else {
                if (typeof _0xb539x9["mozSrcObject"] !== "undefined") {
                    _0xb539x9["mozSrcObject"] = _0xb539xa;
                } else {
                    if (typeof _0xb539x9["src"] !== "undefined") {
                        _0xb539x9["src"] = URL["createObjectURL"](_0xb539xa);
                    } else {
                        PeerStatistic.log("Error attaching stream to element.");
                    }
                    ;
                }
                ;
            }
            ;
        };
        reattachMediaStream = function (_0xb539xb, _0xb539xc) {
            _0xb539xb["src"] = _0xb539xc["src"];
        };
        if (!webkitMediaStream["prototype"]["getVideoTracks"]) {
            webkitMediaStream["prototype"]["getVideoTracks"] = function () {
                return this["videoTracks"];
            };
            webkitMediaStream["prototype"]["getAudioTracks"] = function () {
                return this["audioTracks"];
            };
        }
        ;
        if (!webkitRTCPeerConnection["prototype"]["getLocalStreams"]) {
            webkitRTCPeerConnection["prototype"]["getLocalStreams"] = function () {
                return this["localStreams"];
            };
            webkitRTCPeerConnection["prototype"]["getRemoteStreams"] = function () {
                return this["remoteStreams"];
            };
        }
        ;
    } else {
        PeerStatistic.log("Browser does not appear to be WebRTC-capable");
    }
    ;
}
;
function Queue() {
    var ary = [], top = 0;
    this["getLength"] = function () {
        return ary["length"] - top;
    };
    this["isEmpty"] = function () {
        return 0 == ary["length"];
    };
    this["enqueue"] = function (_0xb539xf) {
        ary["push"](_0xb539xf);
    };
    this["dequeue"] = function () {
        if (0 != ary["length"]) {
            var _0xb539x10 = ary[top];
            2 * ++top >= ary["length"] && (ary = ary["slice"](top), top = 0);
            return _0xb539x10;
        }
        ;
    };
    this["peek"] = function () {
        return 0 < ary["length"] ? ary[top] : void 0;
    };
};
PeerAction = {};
PeerAction.SESSION_ID = "session_id";
PeerAction.FILE_NOT_FOUND = "file_not_found";
PeerAction.FILE_FOUND = "file_found";
PeerAction.OFFER_IMAGE_REQUEST = "offer_image_request";
PeerAction.OFFER_CANDIDATE = _0x3f27[58];
PeerAction.OFFER_SDP = _0x3f27[60];
PeerAction.ANSWER_CANDIDATE = _0x3f27[62];
PeerAction.ANSWER_SDP = _0x3f27[64];
PeerAction.HAS_IMAGE = "has_image";
PeerAction.REQUEST_IMAGE = "request_image";
PeerAction.APPLICATION = "appName";
PeerAction.REQUEST_CON_COUNT = "reqConCount";
PeerAction.COUNT = "count";
PeerAction.requestImageObject = function (url) {
    return {action: PeerAction.REQUEST_IMAGE, file: url};
};
PeerAction.hasImageObject = function (req) {
    return {
        action: PeerAction.HAS_IMAGE,
        size: req.getSize(),
        hash: req.getHash(),
        file: req.getUrl()
    };
};
PeerAction.requestFileObject = function (url) {
    return {action: PeerConnection.ACTION_REQUEST_FILE, url: url};
};
PeerRequest = function (url, cb, t) {
    this.url = url;
    this.callback = cb;
    this.hash = PeerBinaryUtil.calculateHash(url);
    this.size = 0;
    this.loadMethod = null;
    this.convertBase64Method = null;
    this.convertResponseTypeMethod = null;
    this.defineUrlType(t);
};
PeerRequest.prototype.defineUrlType = function (t) {
    if (t != undefined && t == PeerManager.BLOB_TYPE) {
        this.loadMethod = PeerImageUtil.loadImage;
        this.convertBase64Method = PeerImageUtil.convertByteToBase64;
        this.convertResponseTypeMethod = PeerImageUtil.convertByteToBlob;
    } else {
        if (t != undefined && t == PeerManager.TEXT_TYPE) {
            this.loadMethod = PeerImageUtil.loadImage;
            this.convertBase64Method = PeerImageUtil.convertByteToBase64;
            this.convertResponseTypeMethod = function (_0xb539x15) {
                return PeerBinaryUtil.byteToString(_0xb539x15);
            };
        } else {
            if (t != undefined && t == PeerManager.JSON_TYPE) {
                this.loadMethod = PeerImageUtil.loadImage;
                this.convertBase64Method = PeerImageUtil.convertByteToBase64;
                this.convertResponseTypeMethod = function (_0xb539x15) {
                    return JSON.parse(PeerBinaryUtil.byteToString(_0xb539x15));
                };
            } else {
                if (t != undefined && t == PeerManager.ARRAY_BUFFER_TYPE) {
                    this.loadMethod = PeerImageUtil.loadImage;
                    this.convertBase64Method = PeerImageUtil.convertByteToBase64;
                    this.convertResponseTypeMethod = function (_0xb539x15) {
                        if (_0xb539x15 instanceof ArrayBuffer) {
                            return _0xb539x15;
                        }
                        ;
                        return _0xb539x15["buffer"];
                    };
                } else {
                    if (t != undefined && t == PeerManager.IMAGE_TYPE) {
                        this.loadMethod = PeerImageUtil.loadImage;
                        this.convertBase64Method = PeerImageUtil.convertByteToBase64;
                        this.convertResponseTypeMethod = PeerImageUtil.convertByteToBase64;
                    } else {
                        var _0xb539x16 = this["url"]["lastIndexOf"](".");
                        if (_0xb539x16 > 0) {
                            var _0xb539x17 = this["url"]["substr"](_0xb539x16 + 1)["toLowerCase"]();
                            if (_0xb539x17 == "jpg" || _0xb539x17 == "png" || _0xb539x17 == "gif" || _0xb539x17 == "jpeg") {
                                this.loadMethod = PeerImageUtil.loadImage;
                                this.convertBase64Method = PeerImageUtil.convertByteToBase64;
                                this.convertResponseTypeMethod = PeerImageUtil.convertByteToBase64;
                            }
                            ;
                        }
                        ;
                    }
                    ;
                }
                ;
            }
            ;
        }
        ;
    }
    ;
};
PeerRequest.prototype.load = function (cb) {
    this.loadMethod(this.url, cb);
};
PeerRequest.prototype.convertBase64 = function (x) {
    return this.convertBase64Method(x);
};
PeerRequest.prototype.isResponseTypeBase64 = function () {
    return this.convertBase64Method == this.convertResponseTypeMethod;
};
PeerRequest.prototype.convertResponseType = function (x) {
    return this.convertResponseTypeMethod(x);
};
PeerRequest.prototype.sendCallback = function (cb) {
    this.callback(cb);
};
PeerRequest.prototype.getUrl = function () {
    return this.url;
};
PeerRequest.prototype.getHash = function () {
    return this.hash;
};
PeerRequest.prototype.setHash = function (x) {
    this.hash = x;
};
PeerRequest.prototype.getSize = function () {
    return this.size;
};
PeerRequest.prototype.setSize = function (sz) {
    this.size = sz;
};
PeerBinaryUtil = function () {
};
PeerBinaryUtil.calculateHash = function (data) {
    var _0xb539x19 = 0, _0xb539x1b, _0xb539x1c, _0xb539x1d;
    if (data.length == 0) {
        return _0xb539x19;
    }
    ;
    for (_0xb539x1b = 0, _0xb539x1d = data.length; _0xb539x1b < _0xb539x1d; _0xb539x1b++) {
        _0xb539x1c = data.charCodeAt(_0xb539x1b);
        _0xb539x19 = ((_0xb539x19 << 5) - _0xb539x19) + _0xb539x1c;
        _0xb539x19 |= 0;
    }
    ;
    if (_0xb539x19 < 0) {
        _0xb539x19 *= -1;
    }
    ;
    return _0xb539x19;
};
PeerBinaryUtil["LONG_BYTE_LENGTH"] = 8;
PeerBinaryUtil["longToByteArray"] = function (ln) {
    var ary = [0, 0, 0, 0, 0, 0, 0, 0];
    if (ln < 0) {
        ln *= -1;
    }
    ;
    for (var idx = 0; idx < ary["length"]; idx++) {
        var v = ln & 0xff;
        ary[idx] = v;
        ln = (ln - v) / 256;
    }
    ;
    return ary;
};
PeerBinaryUtil["byteArrayToLong"] = function (_0xb539x1f) {
    var _0xb539x18 = 0;
    for (var _0xb539x1b = _0xb539x1f["length"] - 1; _0xb539x1b >= 0; _0xb539x1b--) {
        _0xb539x18 = (_0xb539x18 * 256) + _0xb539x1f[_0xb539x1b];
    }
    ;
    return _0xb539x18;
};
PeerBinaryUtil["calculateLoopSize"] = function (_0xb539x1, _0xb539x21) {
    var _0xb539x22 = _0xb539x1 % _0xb539x21;
    return _0xb539x22 == 0 ? _0xb539x1 / _0xb539x21 : ((_0xb539x1 - _0xb539x22) / _0xb539x21) + 1;
};
PeerBinaryUtil.byteToString = function (bts) {
    if (bts["buffer"] != undefined) {
        bts = bts["buffer"];
    }
    ;
    var _0xb539x24 = 0x8000;
    var _0xb539x16 = 0;
    var _0xb539x25 = bts["byteLength"];
    var _0xb539x26 = "";
    var _0xb539x27;
    while (_0xb539x16 < _0xb539x25) {
        _0xb539x27 = bts["slice"](_0xb539x16, Math["min"](_0xb539x16 + _0xb539x24, _0xb539x25));
        _0xb539x26 += String["fromCharCode"]["apply"](null, new Uint8Array(_0xb539x27));
        _0xb539x16 += _0xb539x24;
    }
    ;
    return _0xb539x26;
};
PeerBinaryUtil["bytesToSize"] = function (sz, dignum) {
    var kb = 1024;
    var mb = kb * 1024;
    var gb = mb * 1024;
    var tb = gb * 1024;
    if ((sz >= 0) && (sz < kb)) {
        return sz + " B";
    } else {
        if ((sz >= kb) && (sz < mb)) {
            return (sz / kb)["toFixed"](dignum) + " KB";
        } else {
            if ((sz >= mb) && (sz < gb)) {
                return (sz / mb)["toFixed"](dignum) + " MB";
            } else {
                if ((sz >= gb) && (sz < tb)) {
                    return (sz / gb)["toFixed"](dignum) + " GB";
                } else {
                    if (sz >= tb) {
                        return (sz / tb)["toFixed"](dignum) + " TB";
                    } else {
                        return sz + " B";
                    }
                    ;
                }
                ;
            }
            ;
        }
        ;
    }
    ;
};
PeerBinaryUtil["ByteArray"] = function (bts) {
    this["buf"] = new ArrayBuffer(bts);
    this["bufView"] = new Uint8Array(this["buf"]);
    this["index"] = 0;
};
PeerBinaryUtil["ByteArray"]["prototype"]["addArray"] = function (_0xb539x23, _0xb539x2d, _0xb539x2e) {
    var _0xb539x1b = _0xb539x2d == undefined ? 0 : _0xb539x2d;
    var _0xb539x2f = _0xb539x2e == undefined ? _0xb539x23["length"] : _0xb539x2e;
    for (; _0xb539x1b < _0xb539x2f; _0xb539x1b++, this["index"]++) {
        this["bufView"][this["index"]] = _0xb539x23[_0xb539x1b];
    }
    ;
};
PeerBinaryUtil["ByteArray"]["prototype"]["getArray"] = function () {
    return this["bufView"];
};
PeerBinaryUtil["ByteArray"]["prototype"]["getArrayBuffer"] = function () {
    return this["buf"];
};
PeerBinaryUtil["ByteArray"]["prototype"]["getLong"] = function () {
    return PeerBinaryUtil["byteArrayToLong"](this["bufView"]);
};
PeerBinaryUtil["FileByteArray"] = function (_0xb539x30) {
    this["url"] = _0xb539x30["getUrl"]();
    this["buf"] = new ArrayBuffer(_0xb539x30["getSize"]());
    this["bufView"] = new Uint8Array(this["buf"]);
    this["index"] = 0;
    this["loopSize"] = PeerBinaryUtil["calculateLoopSize"](_0xb539x30["getSize"](), PeerConnection.SLICE);
};
PeerBinaryUtil["FileByteArray"]["prototype"]["push"] = function (_0xb539x16, _0xb539x1f, _0xb539x2d, _0xb539x2e) {
    var _0xb539x1b = _0xb539x16 * PeerConnection["SLICE"];
    var _0xb539x31 = (_0xb539x2e - _0xb539x2d) + _0xb539x1b;
    for (var _0xb539x32 = _0xb539x2d; _0xb539x1b < _0xb539x31; _0xb539x1b++, _0xb539x32++) {
        this["bufView"][_0xb539x1b] = _0xb539x1f[_0xb539x32];
    }
    ;
    this["index"]++;
    if (this["loopSize"] == this["index"]) {
        return true;
    }
    ;
    return false;
};
PeerBinaryUtil["FileByteArray"]["prototype"]["getUrl"] = function () {
    return this["url"];
};
PeerBinaryUtil["FileByteArray"]["prototype"]["getArray"] = function () {
    return this["bufView"];
};
PeerDataManager = function () {
    this.cache = [];
    this.size = 0;
};
PeerDataManager.prototype.contains = function (key) {
    if (this.cache[key] != null || PeerStorage.get(key) != null) {
        return true;
    }
    ;
    return false;
};
PeerDataManager.prototype.getData = function (key, req) {
    var ab = this.cache[key];
    var result; // base64
    if (ab != null) {
        if (req != undefined) {
            result = req.convertResponseType(ab);
        } else {
            result = PeerImageUtil.convertByteToBase64(ab);
        }
        ;
    } else {
        result = PeerStorage.get(key);
    }
    ;
    return result;
};
PeerDataManager.prototype.getBinaryData = function (_0xb539x11) {
    var _0xb539x33 = this.cache[_0xb539x11];
    if (_0xb539x33 == null) {
        var _0xb539x34 = PeerStorage["get"](_0xb539x11);
        _0xb539x33 = PeerImageUtil["convertBase64ToByte"](_0xb539x34);
    } else {
        _0xb539x33 = new Uint8Array(_0xb539x33);
    }
    ;
    return _0xb539x33;
};
PeerDataManager.prototype.putData = function (req, ab) {
    this.cache[req.getUrl()] = ab;
    PeerStatistic.log("===========" + req.getUrl() + _0x3f27[153] + ab.byteLength);
    this.size += ab.byteLength;
    var sdata = req.convertBase64(ab);
    PeerStorage.put(req.getUrl(), sdata, req.getHash(), ab.byteLength);
    if (!req.isResponseTypeBase64()) {
        sdata = req.convertResponseType(ab);
    }
    ;
    return sdata;
};
PeerManager = function (_0xb539x35, _0xb539x36) {
    this.browserSupport = this.isBrowserSupport();
    this.applicationName = _0xb539x35;
    this.peerServerUrl = _0xb539x36 != null ? _0xb539x36 : PeerManager.PEER_WEBSOCKET_URL;
    this.dataManager = new PeerDataManager();
    this.requestCallback = new Object();
    if (this.browserSupport) {
        this.socket = new PeerSocket(this.peerServerUrl + PeerManager.SIGNALING_URL, _0xb539x35, this);
    }
    ;
};
PeerManager.PEER_WEBSOCKET_URL = location.origin.replace(/^http/, "ws") + "/PeerMeshServer";
PeerManager.SIGNALING_URL = "/signaling";
PeerManager.BLOB_TYPE = "blob";
PeerManager.TEXT_TYPE = "text";
PeerManager.IMAGE_TYPE = "image";
PeerManager.ARRAY_BUFFER_TYPE = "arraybuffer";
PeerManager.JSON_TYPE = "json";
PeerManager.prototype.request = function (url, cb, dt) {
    var data = this.dataManager.getData(url, this.requestCallback[url]);
    var req = new PeerRequest(url, cb, dt);
    var that = this;
    if (data != null) {
        PeerStatistic.log("File is in Local Storage!");
        cb(data);
    } else {
        if (!this.browserSupport) {
            PeerStatistic.log("Browser Does not support webrtc!");
            req.load(cb);
        } else {
            this.socket.initialize(function (isFromPeer) {
                if (isFromPeer) {
                    that.requestPeerServer(req);
                } else {
                    that.loadFile(req, cb);
                }
                ;
            });
        }
        ;
    }
    ;
};
PeerManager.prototype.getConnectionCount = function (_0xb539x13) {
    var act = {action: PeerAction.REQUEST_CON_COUNT};
    this.socket.send(act);
    this.connectionCountListener = _0xb539x13;
};
PeerManager.prototype.loadFile = function (req, cb) {
    var that = this;
    var t = new Date().getTime();
    req.load(function (ab) {
        PeerStatistic.addDownloadSize(ab.byteLength, false);
        req.setSize(ab.byteLength);
        var sdata = that.dataManager.putData(req, ab);
        t = new Date().getTime() - t;
        PeerStatistic.log("File is load from real server! " + t + "ms");
        cb(sdata);
    });
};
PeerManager.prototype.requestPeerServer = function (req) {
    this.requestCallback[req.getUrl()] = req;
    this.socket.send(PeerAction.requestImageObject(req.getUrl()));
};
PeerManager.prototype.fileFound = function (_0xb539x37, _0xb539x33, url) {
    PeerStatistic.log("file is load from another client" + url);
    var req = _0xb539x37.requestCallback[url];
    var cmd = {
        action: PeerAction.HAS_IMAGE,
        file: url,
        size: _0xb539x33.length,
        hash: req.getHash()
    };
    _0xb539x37.socket.send(cmd);
    PeerStatistic.addDownloadSize(_0xb539x33.length, true);
    var _0xb539x15 = _0xb539x37.dataManager.putData(req, _0xb539x33);
    req.sendCallback(_0xb539x15);
};
PeerManager.prototype.fileNotFound = function (_0xb539x37, req) {
    PeerStatistic.log("file not found" + req.getUrl());
    _0xb539x37.loadFile(req, function (_0xb539x18) {
        _0xb539x37.socket.send(PeerAction.hasImageObject(req));
        PeerStatistic.log("file is load from server" + req.getUrl());
        req.sendCallback(_0xb539x18);
    });
};
PeerManager.prototype.isBrowserSupport = function () {
    if (WebSocket == undefined || RTCPeerConnection == null) {
        PeerStatistic.log("Browser does not support websocket or webrtc");
        return false;
    }
    ;
    return true;
};
PeerSocket = function (wshost, appname, pm) {
    this.peerConnectionMap = [];
    this.socket = new WebSocket(wshost);
    this.id = -1;
    this.applicationName = appname;
    this.peerManager = pm;
    this.fileNotFoundCallback = pm.fileNotFound;
    this.fileFoundCallback = pm.fileFound;
    this.isOpened = false;
    this.isInit = false;
    this.callbackList = [];
    var that = this;
    this.socket.onopen = function (cb) {
        that.onopen(cb);
    };
    this.socket.onclose = function (cb) {
        that.onerror(cb);
    };
    this.socket.onerror = function (cb) {
        that.onerror(cb);
    };
    this.socket.onmessage = function (cb) {
        that.onmessage(cb);
    };
};
PeerSocket.prototype.initialize = function (cb) {
    if (this.isInit) {
        cb(this.isOpened);
    } else {
        this.callbackList.push(cb);
    }
    ;
};
PeerSocket.prototype.getTotalQueueSize = function () {
    var _0xb539x3f = 0;
    for (var _0xb539x40 in this.peerConnectionMap) {
        _0xb539x3f += this.peerConnectionMap[_0xb539x40].getQueueSize();
    }
    ;
    return _0xb539x3f;
};
PeerSocket["prototype"]["onopen"] = function (_0xb539x3d) {
    this["isInit"] = true;
    this["isOpened"] = true;
    var that = this;
    var _0xb539x41 = setInterval(function () {
        if (that["isInit"] && that["isOpened"]) {
            var _0xb539x3f = that["getTotalQueueSize"]();
            PeerStatistic.log("Total Queue Size:" + _0xb539x3f);
            that["socket"]["send"](_0x3f27[207] + _0xb539x3f);
        } else {
            clearInterval(_0xb539x41);
        }
        ;
    }, 30000);
    this["fireCallbacks"](true);
    var _0xb539x42 = PeerStorage.getFileList();
    if (_0xb539x42 != null && _0xb539x42["length"] > 0) {
        var _0xb539x3b = {action: PeerAction["HAS_IMAGE"], file: _0xb539x42};
        this["send"](_0xb539x3b);
    }
    ;
    var _0xb539x43 = {action: PeerAction["APPLICATION"], name: that["applicationName"]};
    this["send"](_0xb539x43);
};
PeerSocket["prototype"]["onerror"] = function (_0xb539x3d) {
    this["isInit"] = true;
    this["isOpened"] = false;
    this["fireCallbacks"](false);
};
PeerSocket.prototype.onmessage = function (msg) {
    var _0xb539x15 = JSON.parse(msg["data"]);
    if (_0xb539x15 != null) {
        var _0xb539x44 = _0xb539x15["file"];
        PeerStatistic.log("Action:" + _0xb539x15["action"] + " File:" + _0xb539x44);
        if (_0xb539x15["action"] == PeerAction["SESSION_ID"]) {
            this["id"] = _0xb539x15["id"];
            PeerStatistic.log("Session Id:" + this["id"]);
        } else {
            if (_0xb539x15["action"] == PeerAction.REQUEST_CON_COUNT) {
                if (this["peerManager"]["connectionCountListener"] != null) {
                    this["peerManager"]["connectionCountListener"](_0xb539x15["count"]);
                }
                ;
            } else {
                if (_0xb539x15.action == PeerAction.FILE_NOT_FOUND) {
                    this.fileNotFoundCallback(this.peerManager, this.peerManager.requestCallback[_0xb539x15["file"]]);
                } else {
                    if (_0xb539x15.action == PeerAction.FILE_FOUND) {
                        var _0xb539x12 = this["peerManager"]["requestCallback"][_0xb539x44];
                        _0xb539x12["setSize"](_0xb539x15["size"]);
                        _0xb539x12["setHash"](_0xb539x15["hash"]);
                        if (this["peerConnectionMap"][_0xb539x15["id"]] != null) {
                            var _0xb539x37 = this["peerConnectionMap"][_0xb539x15["id"]];
                            this["peerConnectionMap"][_0xb539x15["id"]]["initialize"](function (_0xb539x26) {
                                if (_0xb539x26) {
                                    _0xb539x37["requestFile"](_0xb539x12);
                                } else {
                                }
                                ;
                            });
                        } else {
                            this["peerConnectionMap"][_0xb539x15["id"]] = new PeerConnection(this, this["peerManager"], _0xb539x15["id"], _0xb539x12);
                            this["peerConnectionMap"][_0xb539x15["id"]]["setFileEventCallback"](this["peerManager"], this["fileFoundCallback"], this["fileNotFoundCallback"]);
                        }
                        ;
                    } else {
                        if (_0xb539x15["action"] == PeerAction["OFFER_IMAGE_REQUEST"]) {
                            this["peerConnectionMap"][_0xb539x15["id"]] = new PeerConnection(this, this["peerManager"], _0xb539x15["id"], this["peerManager"]["requestCallback"][_0xb539x44], false);
                            this["peerConnectionMap"][_0xb539x15["id"]]["setFileEventCallback"](this["peerManager"], this["fileFoundCallback"], this["fileNotFoundCallback"]);
                            this["peerConnectionMap"][_0xb539x15["id"]]["createOffer"]();
                        } else {
                            if (_0xb539x15["action"] == PeerAction["OFFER_CANDIDATE"]) {
                                var _0xb539x45 = new RTCIceCandidate(JSON.parse(_0xb539x15["value"]));
                                this["peerConnectionMap"][_0xb539x15["id"]]["createAnswer"](_0xb539x45);
                            } else {
                                if (_0xb539x15["action"] == PeerAction["OFFER_SDP"]) {
                                    var _0xb539x46 = new RTCSessionDescription(JSON.parse(_0xb539x15["value"]));
                                    this["peerConnectionMap"][_0xb539x15["id"]]["setOfferSdp"](_0xb539x46);
                                } else {
                                    if (_0xb539x15["action"] == PeerAction["ANSWER_CANDIDATE"]) {
                                        var _0xb539x47 = new RTCIceCandidate(JSON.parse(_0xb539x15["value"]));
                                        this["peerConnectionMap"][_0xb539x15["id"]]["addCandidate"](_0xb539x47);
                                    } else {
                                        if (_0xb539x15["action"] == PeerAction["ANSWER_SDP"]) {
                                            var _0xb539x48 = new RTCSessionDescription(JSON.parse(_0xb539x15["value"]));
                                            this["peerConnectionMap"][_0xb539x15["id"]]["setRemoteDescription"](_0xb539x48);
                                        }
                                        ;
                                    }
                                    ;
                                }
                                ;
                            }
                            ;
                        }
                        ;
                    }
                    ;
                }
                ;
            }
            ;
        }
        ;
    }
    ;
};
PeerSocket["prototype"]["send"] = function (_0xb539x3) {
    this["socket"]["send"](JSON.stringify(_0xb539x3));
};
PeerSocket["prototype"]["sendAction"] = function (_0xb539x49, _0xb539x4a, _0xb539x4b) {
    this["send"]({action: _0xb539x49, value: _0xb539x4a, id: _0xb539x4b});
};
PeerSocket["prototype"]["fireCallbacks"] = function (_0xb539x4c) {
    for (var _0xb539x1b = 0; _0xb539x1b < this["callbackList"]["length"]; _0xb539x1b++) {
        this["callbackList"][_0xb539x1b](_0xb539x4c);
    }
    ;
    this["callbackList"] = [];
};
PeerConnection = function (_0xb539x4d, _0xb539x3c, _0xb539x4b, _0xb539x30, _0xb539x4e) {
    this["socket"] = _0xb539x4d;
    this["dataManager"] = _0xb539x3c["dataManager"];
    this["peerManager"] = _0xb539x3c;
    this["id"] = _0xb539x4b;
    this["request"] = _0xb539x30;
    this["isAnswerCreated"] = false;
    this["data"] = [];
    this["fileFoundScope"] = null;
    this["fileFoundCallback"] = null;
    this["fileNotFoundCallback"] = null;
    if (_0xb539x4e == undefined || _0xb539x4e) {
        this["data"][this["request"]["getHash"]()] = new PeerBinaryUtil.FileByteArray(this["request"]);
    }
    ;
    this["isOpened"] = false;
    this["isInit"] = false;
    this["callbackList"] = [];
    this["messageQueue"] = new Queue();
    this["isSendingMessage"] = false;
    this["intervalId"];
    this["channel"];
    this[_0x3f27[231]] = new Date()["getTime"]();
    var _0xb539x4f = {
        "\x69\x63\x65\x53\x65\x72\x76\x65\x72\x73": [{"\x75\x72\x6C": "stun:stun.l.google.com:19302"}, {
            "\x75\x72\x6C": "turn:numb.viagenie.ca",
            "\x63\x72\x65\x64\x65\x6E\x74\x69\x61\x6C": _0x3f27[234],
            "\x75\x73\x65\x72\x6E\x61\x6D\x65": _0x3f27[235]
        }]
    };
    if (window[_0x3f27[236]]) {
        this["pc"] = new RTCPeerConnection();
    } else {
        this["pc"] = new RTCPeerConnection(_0xb539x4f);
    }
    ;
    this["pc"]["candidates"] = {};
};
PeerConnection["STRING_MESSAGE"] = _0x3f27[240];
PeerConnection["SLICE"] = 10000;
PeerConnection["ACTION_REQUEST_FILE"] = _0x3f27[241];
PeerConnection["prototype"]["setFileEventCallback"] = function (_0xb539x37, _0xb539x13, _0xb539x50) {
    this["fileFoundScope"] = _0xb539x37;
    this["fileFoundCallback"] = _0xb539x13;
    this["fileNotFoundCallback"] = _0xb539x50;
};
PeerConnection["prototype"]["sendJson"] = function (_0xb539x51) {
    this["channel"]["send"](PeerConnection["STRING_MESSAGE"] + JSON.stringify(_0xb539x51));
};
PeerConnection["prototype"]["requestFile"] = function (_0xb539x30) {
    this["sendJson"](PeerAction["requestFileObject"](_0xb539x30["getUrl"]()));
    this["data"][_0xb539x30["getHash"]()] = new PeerBinaryUtil.FileByteArray(_0xb539x30);
};
PeerConnection["prototype"]["initialize"] = function (_0xb539x3e) {
    if (this["isInit"]) {
        _0xb539x3e(this["isOpened"]);
    } else {
        this["callbackList"]["push"](_0xb539x3e);
    }
    ;
};
PeerConnection["prototype"]["getQueueSize"] = function () {
    return this["messageQueue"]["getLength"]();
};
PeerConnection["prototype"]["createAnswer"] = function (_0xb539x45) {
    if (!this["isAnswerCreated"]) {
        this["isAnswerCreated"] = true;
        this["pc"]["setRemoteDescription"](this["offerSdp"]);
        this["pc"]["addIceCandidate"](_0xb539x45);
        var that = this;
        this["pc"]["createAnswer"](function (_0xb539x52) {
            that["pc"]["setLocalDescription"](_0xb539x52);
            that["socket"]["sendAction"](PeerAction.ANSWER_SDP, JSON.stringify(_0xb539x52), that["id"]);
        }, function (_0xb539x53) {
            that["fileNotFoundCallback"](that["fileFoundScope"], that["request"]);
        });
        this["pc"]["onicecandidate"] = function (_0xb539x3d) {
            if (_0xb539x3d["candidate"]) {
                PeerStatistic.log(_0x3f27[248] + _0xb539x3d["candidate"]);
                that["socket"]["sendAction"](PeerAction.ANSWER_CANDIDATE, JSON.stringify(_0xb539x3d["candidate"]), that["id"]);
            }
            ;
        };
        this["pc"]["ondatachannel"] = function (_0xb539x54) {
            PeerStatistic.log(_0x3f27[250]);
            receiveChannel = _0xb539x54["channel"];
            that["channel"] = receiveChannel;
            receiveChannel["binaryType"] = "arraybuffer";
            receiveChannel["onopen"] = function (_0xb539x54) {
                var _0xb539x31 = new Date()["getTime"]() - that[_0x3f27[231]];
                that[_0x3f27[231]] = new Date()["getTime"]();
                PeerStatistic.log(_0x3f27[252] + _0xb539x31 + _0x3f27[253]);
                that["isInit"] = true;
                that["isOpened"] = true;
                that["fireCallbacks"](true);
            };
            receiveChannel["onmessage"] = function (_0xb539x54) {
                that["onMessage"](_0xb539x54);
            };
        };
    } else {
        this["addCandidate"](_0xb539x45);
    }
    ;
};
PeerConnection.prototype.setOfferSdp = function (sdp) {
    this.offerSdp = sdp;
};
PeerConnection.prototype.setRemoteDescription = function (sdp) {
    this.pc.setRemoteDescription(sdp);
};
PeerConnection.prototype.addCandidate = function (candi) {
    this.pc.addIceCandidate(candi);
};
PeerConnection.prototype.createOffer = function () {
    var that = this;
    this["pc"]["onicecandidate"] = function (_0xb539x3d) {
        PeerStatistic.log(_0x3f27[255] + _0xb539x3d["candidate"]);
        if (_0xb539x3d["candidate"]) {
            PeerStatistic.log(_0x3f27[248] + _0xb539x3d["candidate"]);
            that["socket"]["sendAction"](PeerAction.OFFER_CANDIDATE, JSON.stringify(_0xb539x3d["candidate"]), that["id"]);
        }
        ;
    };
    var _0xb539x57 = null;
    if (webrtcDetectedBrowser == "chrome") {
        _0xb539x57 = {reliable: false, outOfOrderAllowed: true, maxRetransmitNum: 0};
    } else {
        _0xb539x57 = {reliable: true};
    }
    ;
    var _0xb539x58 = this["pc"]["createDataChannel"]("sendChannel", _0xb539x57);
    this["channel"] = _0xb539x58;
    _0xb539x58["binaryType"] = "arraybuffer";
    _0xb539x58["onopen"] = function () {
        that["sendFile"](that["request"]);
        PeerStatistic.log(_0x3f27[259]);
        that["isInit"] = true;
        that["isOpened"] = true;
        that["fireCallbacks"](true);
        PeerStatistic.log(_0x3f27[252]);
    };
    _0xb539x58["onmessage"] = function (_0xb539x54) {
        that["onMessage"](_0xb539x54);
        PeerStatistic.log(_0x3f27[260]);
    };
    this["pc"]["oniceconnectionstatechange"] = function (_0xb539x3d) {
        PeerStatistic.log(_0x3f27[255] + _0xb539x3d);
    };
    this["pc"]["createOffer"](function (sdp) {
        PeerStatistic.log(_0x3f27[262]);
        that["pc"]["setLocalDescription"](sdp);
        that["socket"]["sendAction"](PeerAction.OFFER_SDP, JSON.stringify(sdp), that["id"]);
    }, function (_0xb539x53) {
        PeerStatistic.log(_0x3f27[263]);
        that["fileNotFoundCallback"](that["fileFoundScope"], that["request"]);
    });
};
PeerConnection["prototype"]["sendFile"] = function (_0xb539x12) {
    var _0xb539x33 = this["dataManager"]["getBinaryData"](_0xb539x12["getUrl"]());
    this["splitDataAndPutQueue"](this["channel"], _0xb539x33, this["pc"], _0xb539x12["getHash"]());
};
PeerConnection.prototype.splitDataAndPutQueue = function (_0xb539x58, _0xb539x15, _0xb539x59, _0xb539x5a) {
    var _0xb539x5b = PeerBinaryUtil["calculateLoopSize"](_0xb539x15["length"], PeerConnection.SLICE);
    var _0xb539x5c = PeerBinaryUtil["longToByteArray"](_0xb539x5a);
    for (var _0xb539x1b = 0; _0xb539x1b < _0xb539x5b; _0xb539x1b++) {
        var _0xb539x5d = PeerBinaryUtil["longToByteArray"](_0xb539x1b);
        var _0xb539x2d = _0xb539x1b * PeerConnection["SLICE"];
        var _0xb539x2e = _0xb539x2d + PeerConnection["SLICE"] < _0xb539x15["length"] ? _0xb539x2d + PeerConnection["SLICE"] : _0xb539x15["length"];
        var _0xb539x1f = new PeerBinaryUtil.ByteArray((_0xb539x2e - _0xb539x2d) + _0xb539x5c["length"] + _0xb539x5d["length"]);
        _0xb539x1f["addArray"](_0xb539x5c);
        _0xb539x1f["addArray"](_0xb539x5d);
        _0xb539x1f["addArray"](_0xb539x15, _0xb539x2d, _0xb539x2e);
        this["enqueueMessage"](_0xb539x1f["getArray"]());
    }
    ;
};
PeerConnection.prototype.enqueueMessage = function (msg) {
    this.messageQueue.enqueue(msg);
    if (this.messageQueue.getLength() == 1 && !this.isSendingMessage) {
        var _0xb539x5e = 10;
        var that = this;
        that.sendNextMessage();
    }
    ;
};
PeerConnection.prototype.sendNextMessage = function () {
    var _0xb539x5f = this["messageQueue"]["dequeue"]();
    PeerStatistic["addUploadSize"](_0xb539x5f["length"]);
    this["channel"]["send"](_0xb539x5f);
    if (this["messageQueue"]["getLength"]() == 0) {
        clearInterval(this["intervalId"]);
    }
    ;
};
PeerConnection.prototype.onMessage = function (_0xb539x54) {
    if (_0xb539x54["data"]["slice"](0, PeerConnection["STRING_MESSAGE"]["length"]) == PeerConnection["STRING_MESSAGE"]) {
        var _0xb539x15 = JSON.parse(_0xb539x54["data"]["slice"](PeerConnection["STRING_MESSAGE"]["length"], _0xb539x54["data"]["length"]));
        if (_0xb539x15["action"] == PeerConnection["ACTION_REQUEST_FILE"]) {
            this["sendFile"](this["peerManager"]["requestCallback"][_0xb539x15["url"]]);
        }
        ;
        PeerStatistic.log("channel action" + _0xb539x15["action"]);
    } else {
        var _0xb539x1f = new Uint8Array(_0xb539x54["data"]);
        var _0xb539x5c = new PeerBinaryUtil.ByteArray(PeerBinaryUtil.LONG_BYTE_LENGTH);
        _0xb539x5c["addArray"](_0xb539x1f, 0, PeerBinaryUtil.LONG_BYTE_LENGTH);
        var _0xb539x19 = _0xb539x5c["getLong"]();
        var _0xb539x5d = new PeerBinaryUtil.ByteArray(PeerBinaryUtil.LONG_BYTE_LENGTH);
        _0xb539x5d["addArray"](_0xb539x1f, PeerBinaryUtil.LONG_BYTE_LENGTH, PeerBinaryUtil["LONG_BYTE_LENGTH"] * 2);
        var _0xb539x16 = _0xb539x5d["getLong"]();
        if (_0xb539x16 == 0) {
            this[_0x3f27[231]] = new Date()["getTime"]();
        }
        ;
        var _0xb539x60 = this["data"][_0xb539x19];
        var _0xb539x61 = _0xb539x60["push"](_0xb539x16, _0xb539x1f, PeerBinaryUtil["LONG_BYTE_LENGTH"] * 2, _0xb539x54["data"]["byteLength"]);
        if (_0xb539x61) {
            this["fileFoundCallback"](this["fileFoundScope"], _0xb539x60["getArray"](), _0xb539x60["getUrl"]());
            var _0xb539x31 = new Date()["getTime"]() - this[_0x3f27[231]];
            PeerStatistic.log("message" + _0xb539x31 + _0x3f27[253]);
        }
        ;
    }
    ;
};
PeerConnection["prototype"]["fireCallbacks"] = function (_0xb539x4c) {
    for (var _0xb539x1b = 0; _0xb539x1b < this["callbackList"]["length"]; _0xb539x1b++) {
        this["callbackList"][_0xb539x1b](_0xb539x4c);
    }
    ;
    this["callbackList"] = [];
};
PeerStorage = function () {
    this.fileList;
};
PeerStorage.ITEMS_KEY = "PeerFiles";
PeerStorage.FILE_PREFIX = "Peer:";
PeerStorage.getFileList = function () {
    if (typeof (Storage) !== "undefined") {
        var _0xb539x62 = localStorage.getItem(PeerStorage.ITEMS_KEY);
        if (_0xb539x62 != null) {
            this.fileList = JSON.parse(_0xb539x62);
        } else {
            this.fileList = new Array();
        }
        ;
    }
    ;
    return this.fileList;
};
PeerStorage.get = function (_0xb539x11) {
    if (typeof (Storage) !== "undefined") {
    }
    ;
    return null;
};
PeerStorage.put = function (url, data, hash, size) {
    var _0xb539x63 = true;
    _0xb539x63 &= PeerStorage.putLocalStorage(PeerStorage.FILE_PREFIX + url, data);
    if (this.fileList == null) {
        this.fileList = new Array();
    }
    ;
    var _0xb539x64 = {url: url, hash: hash, size: size};
    this.fileList["push"](_0xb539x64);
    _0xb539x63 &= PeerStorage.putLocalStorage(PeerStorage.ITEMS_KEY, JSON.stringify(this.fileList));
    return false;
};
PeerStorage["putLocalStorage"] = function (_0xb539x65, _0xb539x18) {
    if (typeof (Storage) !== "undefined") {
        try {
            return true;
        } catch (e) {
            if (e["QUOTA_EXCEEDED_ERR"] == e["code"]) {
                PeerStatistic.log(e["message"]);
            }
            ;
        }
        ;
    }
    ;
    return false;
};
PeerImageUtil = function () {
};
PeerImageUtil._keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
PeerImageUtil.loadImage = function (url, cb) {
    var xhr = new XMLHttpRequest();
    xhr.open("GET", url, true);
    xhr.responseType = "arraybuffer";
    xhr.onload = function (v) {
        cb(xhr.response);
    };
    xhr.onerror = function (err) {
        PeerStatistic.log(err);
    };
    xhr.send(null);
};
PeerImageUtil.convertByteToBlob = function (bt) {
    return new Blob([bt]);
};
PeerImageUtil.convertByteToBase64 = function (bts) {
    var _0xb539x34 = "";
    var _0xb539x68 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    var uary = new Uint8Array(bts);
    var len = uary.byteLength;
    var _0xb539x6a = len % 3;
    var _0xb539x6b = len - _0xb539x6a;
    var _0xb539xe, _0xb539xf, _0xb539x10, _0xb539x6c;
    var _0xb539x6d;
    for (var _0xb539x1b = 0; _0xb539x1b < _0xb539x6b; _0xb539x1b = _0xb539x1b + 3) {
        _0xb539x6d = (uary[_0xb539x1b] << 16) | (uary[_0xb539x1b + 1] << 8) | uary[_0xb539x1b + 2];
        _0xb539xe = (_0xb539x6d & 16515072) >> 18;
        _0xb539xf = (_0xb539x6d & 258048) >> 12;
        _0xb539x10 = (_0xb539x6d & 4032) >> 6;
        _0xb539x6c = _0xb539x6d & 63;
        _0xb539x34 += _0xb539x68[_0xb539xe] + _0xb539x68[_0xb539xf] + _0xb539x68[_0xb539x10] + _0xb539x68[_0xb539x6c];
    }
    ;
    if (_0xb539x6a == 1) {
        _0xb539x6d = uary[_0xb539x6b];
        _0xb539xe = (_0xb539x6d & 252) >> 2;
        _0xb539xf = (_0xb539x6d & 3) << 4;
        _0xb539x34 += _0xb539x68[_0xb539xe] + _0xb539x68[_0xb539xf] + "==";
    } else {
        if (_0xb539x6a == 2) {
            _0xb539x6d = (uary[_0xb539x6b] << 8) | uary[_0xb539x6b + 1];
            _0xb539xe = (_0xb539x6d & 16128) >> 8;
            _0xb539xf = (_0xb539x6d & 1008) >> 4;
            _0xb539x10 = (_0xb539x6d & 15) << 2;
            _0xb539x34 += _0xb539x68[_0xb539xe] + _0xb539x68[_0xb539xf] + _0xb539x68[_0xb539x10] + "=";
        }
        ;
    }
    ;
    return "data:image/jpeg;base64," + _0xb539x34;
};
PeerImageUtil.convertBase64ToByte = function (data) {
    var hdr = "base64,";
    var idx = data["indexOf"](hdr);
    if (idx != -1) {
        data = data["substr"](idx + hdr["length"]);
    }
    ;
    var _0xb539x20 = (data.length / 4) * 3;
    var _0xb539x70 = new ArrayBuffer(_0xb539x20);
    var _0xb539x71 = this._keyStr.indexOf(data.charAt(data.length - 1));
    var _0xb539x72 = this._keyStr.indexOf(data.charAt(data.length - 2));
    var _0xb539x20 = (data.length / 4) * 3;
    if (_0xb539x71 == 64) {
        _0xb539x20--;
    }
    ;
    if (_0xb539x72 == 64) {
        _0xb539x20--;
    }
    ;
    var _0xb539x73;
    var _0xb539x74, _0xb539x75, _0xb539x76;
    var _0xb539x77, _0xb539x78, _0xb539x79, _0xb539x7a;
    var _0xb539x1b = 0;
    var _0xb539x32 = 0;
    if (_0xb539x70) {
        _0xb539x73 = new Uint8Array(_0xb539x70);
    } else {
        _0xb539x73 = new Uint8Array(_0xb539x20);
    }
    ;
    data = data["replace"](/[^A-Za-z0-9\+\/\=]/g, "");
    for (_0xb539x1b = 0; _0xb539x1b < _0xb539x20; _0xb539x1b += 3) {
        _0xb539x77 = this["_keyStr"]["indexOf"](data["charAt"](_0xb539x32++));
        _0xb539x78 = this["_keyStr"]["indexOf"](data["charAt"](_0xb539x32++));
        _0xb539x79 = this["_keyStr"]["indexOf"](data["charAt"](_0xb539x32++));
        _0xb539x7a = this["_keyStr"]["indexOf"](data["charAt"](_0xb539x32++));
        _0xb539x74 = (_0xb539x77 << 2) | (_0xb539x78 >> 4);
        _0xb539x75 = ((_0xb539x78 & 15) << 4) | (_0xb539x79 >> 2);
        _0xb539x76 = ((_0xb539x79 & 3) << 6) | _0xb539x7a;
        _0xb539x73[_0xb539x1b] = _0xb539x74;
        if (_0xb539x79 != 64) {
            _0xb539x73[_0xb539x1b + 1] = _0xb539x75;
        }
        ;
        if (_0xb539x7a != 64) {
            _0xb539x73[_0xb539x1b + 2] = _0xb539x76;
        }
        ;
    }
    ;
    return _0xb539x73;
};
